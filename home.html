<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Home</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#135bec",
            "background-light": "#f6f6f8",
            "background-dark": "#101622"
          },
          fontFamily: {
            display: ["Inter", "sans-serif"]
          }
        }
      }
    }
  </script>
</head>

<body class="bg-background-light dark:bg-background-dark font-display">

<!-- ================= HEADER ================= -->
<div class="sticky top-0 z-10 bg-background-light dark:bg-background-dark p-4">
  <h2 class="text-lg font-bold text-gray-900 dark:text-white">Home</h2>

  <input
    id="searchInput"
    placeholder="Search properties, food, items..."
    class="w-full mt-3 h-12 px-4 rounded-lg bg-gray-200 dark:bg-[#232f48] text-gray-900 dark:text-white outline-none"
  />
</div>

<!-- ================= MAIN ================= -->
<main class="pb-24">

  <!-- PROPERTIES -->
  <section class="mt-6">
    <h2 class="px-4 text-xl font-bold text-gray-900 dark:text-white">Newest Properties</h2>
    <div id="propertyList" class="flex gap-4 px-4 mt-4 overflow-x-auto"></div>
  </section>

  <!-- FOOD -->
  <section class="mt-8">
    <h2 class="px-4 text-xl font-bold text-gray-900 dark:text-white">Fresh on the Menu</h2>
    <div id="foodList" class="flex gap-4 px-4 mt-4 overflow-x-auto"></div>
  </section>

  <!-- ITEMS -->
  <section class="mt-8">
    <h2 class="px-4 text-xl font-bold text-gray-900 dark:text-white">Latest Arrivals</h2>
    <div id="itemsList" class="flex gap-4 px-4 mt-4 overflow-x-auto"></div>
  </section>

</main>

<script>
/* ================= SUPABASE CONFIG ================= */
const supabase = supabase.createClient(
  "https://ithiomhjbakdqhpqdnus.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0aGlvbWhqYmFrZHFocHFkbnVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyODU2MDEsImV4cCI6MjA4MDg2MTYwMX0.H2cIypWgF5D6swr0WVKQ99GZE5WzBQ3C-hcHqN6x5LM"
);

/* ================= HELPERS ================= */
function productCard({ title, price, image, location }) {
  return `
    <div class="min-w-[220px] bg-white dark:bg-[#192233] rounded-xl shadow overflow-hidden">
      <div class="h-36 bg-cover bg-center" style="background-image:url('${image || ""}')"></div>
      <div class="p-3">
        <p class="font-bold text-gray-900 dark:text-white">${title}</p>
        ${location ? `<p class="text-sm text-gray-500">${location}</p>` : ""}
        <p class="text-primary font-semibold mt-1">$${price}</p>
      </div>
    </div>
  `;
}

/* ================= FETCH FUNCTIONS ================= */
async function loadCategory(table, containerId) {
  const container = document.getElementById(containerId);

  const { data, error } = await supabase
    .from(table)
    .select("*")
    .order("created_at", { ascending: false })
    .limit(5);

  if (error || !Array.isArray(data) || data.length === 0) {
    container.innerHTML = "";
    return;
  }

  container.innerHTML = data.map(item =>
    productCard({
      title: item.title,
      price: item.price,
      image: item.image,
      location: item.location
    })
  ).join("");
}

/* ================= SEARCH ================= */
document.getElementById("searchInput").addEventListener("input", async (e) => {
  const q = e.target.value.trim();
  if (!q) {
    loadAll();
    return;
  }

  const tables = ["food", "property", "items"];
  const results = [];

  for (const table of tables) {
    const { data } = await supabase
      .from(table)
      .select("*")
      .ilike("title", `%${q}%`)
      .limit(5);

    if (Array.isArray(data)) results.push(...data);
  }

  document.getElementById("propertyList").innerHTML = "";
  document.getElementById("foodList").innerHTML = "";
  document.getElementById("itemsList").innerHTML =
    results.map(item => productCard(item)).join("");
});

/* ================= LOAD ALL ================= */
function loadAll() {
  loadCategory("property", "propertyList");
  loadCategory("food", "foodList");
  loadCategory("items", "itemsList");
}

/* ================= INIT ================= */
loadAll();
</script>

</body>
</html>
