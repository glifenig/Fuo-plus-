<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel - FUO Plus</title>
<style>
  body { font-family: Arial; padding: 20px; }
  .section { margin-top: 20px; padding: 10px; border: 1px solid #ddd; border-radius:10px; }
  input, textarea, select, button {
    width: 100%; padding: 10px; margin: 6px 0;
    border-radius: 5px; border: 1px solid #ccc;
  }
  button { cursor: pointer; background: #008cff; color:white; }
  button:hover { opacity: 0.8; }
</style>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js";

const supabaseUrl = "https://nhopxxebahavtziafmnd.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ob3B4eGViYWhhdnR6aWFmbW5kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5ODA4MTMsImV4cCI6MjA4MDU1NjgxM30.3okIjvZQNM56a8qIdMq8P677xXWJJLRo8cgEMMDqBh8";

window.supabase = createClient(supabaseUrl, supabaseKey);

// ---------------- LOGIN ----------------
window.login = function () {
  const pass = document.getElementById("adminPass").value;
  if (pass === "1234") {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("adminPanel").style.display = "block";
  } else {
    alert("Wrong Password!");
  }
};

// ---------- IMAGE UPLOAD FUNCTION ----------
window.uploadImages = async function(files, bucket) {
  const urls = [];
  for (const file of files) {
    const fileName = Date.now() + "_" + file.name;
    const { error } = await supabase.storage.from(bucket).upload(fileName, file);
    if (error) return alert(error.message);
    const { data: publicURL } = supabase.storage.from(bucket).getPublicUrl(fileName);
    urls.push(publicURL.publicUrl);
  }
  return urls;
};

// --------------------------------------------
// ADD PROPERTY
// --------------------------------------------
window.addProperty = async function () {
  const title = document.getElementById('pTitle').value;
  const price = document.getElementById('pPrice').value;
  const type = document.getElementById('pType').value;
  const short_desc = document.getElementById('pShort').value;
  const long_desc = document.getElementById('pLong').value;
  const imagesFile = document.getElementById('pImages').files;

  if (imagesFile.length < 1) return alert("Select at least 1 image");

  const imageUrls = await uploadImages(imagesFile, "properties");

  const { error } = await supabase.from("properties").insert({
    title, price, type, short_desc, long_desc, images: imageUrls
  });

  if (!error) {
    alert("Property added successfully!");
    document.getElementById("pTitle").value = "";
    document.getElementById("pPrice").value = "";
    document.getElementById("pShort").value = "";
    document.getElementById("pLong").value = "";
    document.getElementById("pImages").value = "";
  } else alert(error.message);
};

// --------------------------------------------
// ADD FOOD
// --------------------------------------------
window.addVariationField = function() {
  const div = document.createElement("div");
  div.innerHTML = `
    <input type="text" placeholder="Option Name" class="vName">
    <input type="number" placeholder="Price" class="vPrice">
  `;
  document.getElementById("variationList").appendChild(div);
};

window.addFood = async function () {
  const title = document.getElementById("fTitle").value;
  const short_desc = document.getElementById("fShort").value;
  const long_desc = document.getElementById("fLong").value;
  const imageFile = document.getElementById("fImage").files[0];

  if (!imageFile) return alert("Upload an image");

  const variationNames = document.getElementsByClassName("vName");
  const variationPrices = document.getElementsByClassName("vPrice");
  const variations = [];

  for (let i = 0; i < variationNames.length; i++) {
    if (variationNames[i].value && variationPrices[i].value) {
      variations.push({
        text: variationNames[i].value,
        price: Number(variationPrices[i].value),
      });
    }
  }

  if (variations.length === 0) return alert("Add price options");

  const urls = await uploadImages([imageFile], "food");

  const { error } = await supabase.from("food").insert({
    title, short_desc, long_desc,
    image: urls[0],
    variations
  });

  if (!error) {
    alert("Food added successfully!");
    document.getElementById("variationList").innerHTML = "";
    document.getElementById("fTitle").value = "";
    document.getElementById("fShort").value = "";
    document.getElementById("fLong").value = "";
    document.getElementById("fImage").value = "";
  }
};

// --------------------------------------------
// ADD ITEM
// --------------------------------------------
window.addItem = async function () {
  const title = document.getElementById('iTitle').value;
  const price = document.getElementById('iPrice').value;
  const category = document.getElementById('iCategory').value;
  const short_desc = document.getElementById('iShort').value;
  const long_desc = document.getElementById('iLong').value;
  const imagesFile = document.getElementById('iImages').files;

  if (imagesFile.length < 1) return alert("Select at least 1 image");

  const imageUrls = await uploadImages(imagesFile, "items");

  const { error } = await supabase.from("items").insert({
    title, price, category, short_desc, long_desc, images: imageUrls
  });

  if (!error) {
    alert("Item added successfully!");
    document.getElementById("iTitle").value = "";
    document.getElementById("iPrice").value = "";
    document.getElementById("iShort").value = "";
    document.getElementById("iLong").value = "";
    document.getElementById("iImages").value = "";
  }
};
</script>
</head>

<body>
<h2>Admin Panel - FUO Plus</h2>

<div id="loginBox">
  <p>Enter Admin Password</p>
  <input type="password" id="adminPass">
  <button onclick="login()">Login</button>
</div>

<div id="adminPanel" style="display:none;">

  <!-- PROPERTY SECTION -->
  <h3>Add Property</h3>
  <div class="section">
    <input type="text" id="pTitle" placeholder="Title">
    <input type="number" id="pPrice" placeholder="Price">
    <select id="pType">
      <option value="sell">Sell</option>
      <option value="rent">Rent</option>
    </select>
    <textarea id="pShort" placeholder="Short Description"></textarea>
    <textarea id="pLong" placeholder="Long Description"></textarea>
    <input type="file" id="pImages" multiple>
    <button onclick="addProperty()">Upload Property</button>
  </div>

  <!-- FOOD SECTION -->
  <h3>Add Food</h3>
  <div class="section">
    <input type="text" id="fTitle" placeholder="Food Title">
    <textarea id="fShort" placeholder="Short Description"></textarea>
    <textarea id="fLong" placeholder="Long Description"></textarea>
    <label>Food Image:</label>
    <input type="file" id="fImage">
    <h4>Food Options (Variation)</h4>
    <div id="variationList"></div>
    <button onclick="addVariationField()">Add Price Option</button>
    <button onclick="addFood()">Upload Food</button>
  </div>

  <!-- ITEMS SECTION -->
  <h3>Add Item</h3>
  <div class="section">
    <input type="text" id="iTitle" placeholder="Item Title">
    <input type="number" id="iPrice" placeholder="Price">
    <select id="iCategory">
      <option value="new">New</option>
      <option value="used">Used</option>
    </select>
    <textarea id="iShort" placeholder="Short Description"></textarea>
    <textarea id="iLong" placeholder="Long Description"></textarea>
    <input type="file" id="iImages" multiple>
    <button onclick="addItem()">Upload Item</button>
  </div>

</div>

</body>
</html>
